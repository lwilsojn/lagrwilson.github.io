var BF=BF||function(){var s=new window.TinyEmitter,r={},i={};function a(e,t){var n=new o(e);r[e].call(n,n,t)}var o=function(t){var n={on:function(e,t){s.on(e,function(e){t.call(n,e)})},emit:function(e,t){s.emit(e,t)},init:function(e){setTimeout(function(){e.call(n)})},start:function(e){s.on(BF.events.START,function(){e.call(n)})},error:function(e){console.error("Brooks Finder ERROR\n","Location: "+t+"\n",'Error: "'+e+'"')}};return n};function t(e){for(var t in r){var n="data-bf-"+t,s="["+n+"]",i=e.querySelectorAll(s);try{for(var o=0;o<i.length;o++)a(t,i[o]);e.hasAttribute(n)&&a(t,e)}catch(e){console.error("Brooks Finder ERROR\n","Location: component "+t+"\n",'Error: "'+e+'"')}}}return{start:function(){var e=document.querySelector("[data-bf-app]");null!==e&&t(e),s.emit(BF.events.START)},component:function(e,t){r[e]=t},service:function(e,t){var n=new o(e);i[e]=t.call(n,n)},services:i,compile:t}}();BF.events={START:"START",SET_FORM_VALUES:"SET_FORM_VALUES",FORM_VALUE_CHANGE:"FORM_VALUE_CHANGE",SCREEN_TRANSITION_START:"SCREEN_TRANSITION_START",SCREEN_TRANSITION_ACTIVE:"SCREEN_TRANSITION_ACTIVE",SCREEN_TRANSITION_END:"SCREEN_TRANSTION_END",WINDOW_RESIZE:"WINDOW_RESIZE",ORIENTATION_CHANGE:"ORIENTATION_CHANGE",USER_SCROLL:"USER_SCROLL",OPEN_MODAL:"OPEN_MODAL",CLOSE_MODAL:"CLOSE_MODAL",OPEN_EDIT_ANSWERS:"OPEN_EDIT_ANSWERS",CLOSE_EDIT_ANSWERS:"CLOSE_EDIT_ANSWERS",UPDATE_ANSWERS:"UPDATE_ANSWERS",OPEN_IMAGE:"OPEN_IMAGE",CLOSE_IMAGE:"CLOSE_IMAGE",OPEN_FORM_OVERLAY:"OPEN_FORM_OVERLAY",CLOSE_FORM_OVERLAY:"CLOSE_FORM_OVERLAY",OPEN_PROGRESS_MENU:"OPEN_PROGRESS_MENU",CLOSE_PROGRESS_MENU:"CLOSE_PROGRESS_MENU",SHOW_PROGRESS_MENU:"SHOW_PROGRESS_MENU",HIDE_PROGRESS_MENU:"HIDE_PROGRESS_MENU",HIDE_SCREENS:"HIDE_SCREENS",SHOW_SCREENS:"SHOW_SCREENS",LOADING_SCREEN_DATA:"LOADING_SCREEN_DATA",SCREEN_DATA_LOADED:"SCREEN_DATA_LOADED"},BF.helpers={prefixedCssObject:function(t){var e=["webkit","ms","moz"],n={};for(var s in t)n[s]=t[s],e.map(function(e){n["-"+e+"-"+s]=t[s]});return n},isFormScreen:function(e){return"form"===e.type},isIE:function(){return-1!==navigator.userAgent.indexOf("MSIE")||0<navigator.appVersion.indexOf("Trident/")}},BF.service("api",function(e){return{call:function(n,s){return new Promise(function(t,e){$.ajax({url:n,type:s,data:BF.services.form.rawFormValues(),success:function(e){t(e)},error:function(){e("There was an error. Please try again")}})})}}}),BF.service("device",function(e){return e.props={slowConnectionThreshold:2e3},e.state={hasTouch:function(){var e=" -webkit- -moz- -o- -ms- ".split(" ");if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)return!0;var t=["(",e.join("touch-enabled),("),"heartz",")"].join("");return function(e){return window.matchMedia(e).matches}(t)}(),hasSlowConnection:!(!window.performance||!window.performance.timing)&&window.performance.timing.responseStart-window.performance.timing.requestStart>e.props.slowConnectionThreshold},{hasTouch:e.state.hasTouch,hasSlowConnection:e.state.hasSlowConnection}}),BF.service("form",function(i){i.state={formValues:[],formSteps:[],sendProgressHandler:null};var e=document.querySelector('form[name="bf-form"]');if(!e)return i.error("Form not found");function t(){return $(i.els.form).serializeArray()}function n(){i.state.formValues=t(),i.emit(BF.events.SET_FORM_VALUES,i.state.formValues)}function s(){var e=i.state.formValues.filter(function(e){return"screen_progress"==e.name})[0];return e?e.value:0}function o(e){return BF.services.screens.screenIndexById(e.id)<=s()}function r(){return i.state.formSteps.filter(o)}return i.els={form:e,inputs:$(e).find(":input")},i.els.inputs.each(function(){this.addEventListener("change",n.bind(i))}),i.on(BF.events.SCREEN_TRANSITION_START,n.bind(i)),i.els.form.addEventListener("submit",function(e){e.preventDefault()}),i.start(function(){n()}),{registerFormStep:function(e){i.state.formSteps.push(e)},updateFormValues:function(){setTimeout(function(){n()})},sendFormProgress:function(){clearTimeout(i.state.sendProgressHandler),i.state.sendProgressHandler=setTimeout(function(){BF.services.api.call(BF.endpoints.sendProgress.url,BF.endpoints.sendProgress.type)},500)},formValues:function(){return i.state.formValues},rawFormValues:function(){return t()},formValue:function(t){return i.state.formValues.filter(function(e){return e.name==t})},screenProgressValue:s,inputValueString:function(t){var e=i.state.formValues.filter(function(e){return e.name==t});if(!e.length||0===e.filter(function(e){return 0<e.value.length}).length)return"";var n="";return e.map(function(e,t){n+=(0<t?",":"")+e.value}),n},inputValueLabels:function(t){var e=i.els.form,n=Array.from(e.elements).filter(function(e){return e.name==t&&e.checked});return n.length&&0!==n.filter(function(e){return 0<e.value.length}).length?n.map(function(e){return $('label[for="'+e.id+'"]').text().trim().toLowerCase()}):""},inputMatchesValue:function(e,t){if(!e.length)return!1;var n=!1;return e.map(function(e){!function(t,e){var n=!1,s=i.state.formValues.filter(function(e){return e.name==t});if(s.length)return e&&e.length?s.map(function(t){e.map(function(e){t.value==e&&(n=!0)})}):s.map(function(e){e.value&&e.value.length&&"none"!==e.value&&(n=!0)}),n}(e,t)||(n=!0)}),n},uncheckInput:function(e,t){i.els.inputs.each(function(){this.name==e&&(this.checked=!1)}),setTimeout(function(){n()},10)},setInputValue:function(e,t){i.els.inputs.each(function(){this.name==e&&(this.value=t)}),n()},allStepsCompleted:function(){return r().length===i.state.formSteps.length},completedSteps:r,completedById:function(e){return o((t=e,i.state.formSteps.filter(function(e){return e.id===t})[0]));var t},completedByIndex:function(e){return o(i.state.formSteps[e])},reset:function(e){(e=e?$(e):$(i.els.form)).find("input:text, input:password, input:file, select, textarea").val(""),e.find("input:radio, input:checkbox").removeAttr("checked").removeAttr("selected"),e.find("input:radio, input:checkbox").each(function(){this.checked=!1}),e.find('input[name="screen_progress"]').val("0"),e.find("input,select,textarea").each(function(){$(this).change()}),n()},formIsComplete:function(){return i.state.formSteps.filter(o).length===i.state.formSteps.length}}}),BF.service("history",function(t){t.state={initialized:!1,navigatingByPopstate:!1},window.addEventListener("popstate",function(e){e.state&&e.state.id&&(t.state.navigatingByPopstate=!0,BF.services.screens.changeScreen(e.state.id))}),t.on(BF.events.SCREEN_TRANSITION_START,function(e){if(!t.state.initialized)return t.state.initialized=!0,history.replaceState({id:e.active.id},e.active.id,window.location.href);t.state.navigatingByPopstate||history.pushState({id:e.active.id},null,null),t.state.initialized=!0,t.state.navigatingByPopstate=!1})}),BF.service("screens",function(r){function t(){if(!r.state.screens.length)return setTimeout(function(){t()},50);if(void 0!==window.URLSearchParams){var e=new URLSearchParams(window.location.search);if(e.has("screen"))return r.state.manualMode=!0,n(e.get("screen"))}return BF.services.form.bypass?a(r.state.screens[BF.services.form.bypass].id):BF.services.form.allStepsCompleted()?a(r.state.screens[r.state.screens.length-1].id):void a(r.state.screens[0].id)}function n(e){var t=c(r.state.activeScreenId),n=r.state.screens[e];if(e>=r.state.screens.length-1)return a(r.state.screens[r.state.screens.length-1].id);if(r.state.screens[e]){if(r.state.manualMode)return a(r.state.screens[e].id);var s,i=null;if(null!==t){for(var o=0;o<e;o++)i&&r.state.screens[o].type==i.type&&(i=null),r.state.screens[o].hasPriority&&o>c(r.state.activeScreenId)&&(i=r.state.screens[o]);if(i)for(o=c(i.id);o<=e;o++)if(BF.helpers.isFormScreen(r.state.screens[o])&&(s=r.state.screens[o].id,!BF.services.form.completedById(s)))return a(i.id)}a(n.id)}}function a(e){if(e&&r.state.activeScreenId!=e&&!r.state.transitionInProgress&&!r.state.loadingDependency){var t=i(e);if(!t.dependency)return s(e);r.state.loadingDependency=!0,r.emit(BF.events.LOADING_SCREEN_DATA,t.id),t.dependency().then(function(e){r.state.loadingDependency=!1,r.emit(BF.events.SCREEN_DATA_LOADED,{id:t.id,data:e}),setTimeout(function(){s(t.id)})}).catch(function(e){alert(e),r.state.loadingDependency=!1})}}function s(e){var t,n;r.state.transitionInProgress=!0,r.state.previousScreenId=r.state.activeScreenId,r.state.activeScreenId=e;var s={active:t=i(r.state.activeScreenId),previous:n=i(r.state.previousScreenId),reverse:!!n&&c(t.id)<c(n.id)};r.emit(BF.events.SCREEN_TRANSITION_START,s),setTimeout(function(){window.requestAnimationFrame(function(){r.emit(BF.events.SCREEN_TRANSITION_ACTIVE,s),setTimeout(function(){window.scrollTo(0,0)},750),setTimeout(function(){if(r.state.transitionInProgress=!1,r.emit(BF.events.SCREEN_TRANSITION_END,s),void 0!==window.CustomEvent){var e=new CustomEvent("finderScreenChange",{bubbles:!0,cancelable:!0,detail:{previous:s.previous?s.previous.id:null,active:s.active.id}}),t=window.document.querySelector('[data-bf-screen][data-id="'+s.active.id+'"]');t&&"loading"!=s.active.id&&t.dispatchEvent(e)}},r.props.transitionLength)})},50)}function i(t){return t?r.state.screens.filter(function(e){return e.id===t})[0]:null}function c(n){var s=null;return r.state.screens.map(function(e,t){e.id===n&&(s=t)}),s}function e(){return c(r.state.activeScreenId)}function o(e,t){if(!e)return 0;for(var n=0,s=0;s<r.state.screens.length&&r.state.screens[s].id!==e;s++)r.state.screens[s].type===t&&n++;return n}return r.props={transitionLength:2500},r.state={manualMode:!1,initialized:!1,transitionInProgress:!1,loadingDependency:!1,activeScreenId:null,previousScreenId:null,screens:[]},r.init(function(){setTimeout(t,100)}),{registerScreen:function(e){r.state.screens.push({id:e.id,type:e.type,hasPriority:e.hasPriority,dependency:e.dependency&&"function"==typeof e.dependency?e.dependency:null})},nextScreen:function(){setTimeout(function(){null===r.state.activeScreenId?n(0):n(e()+1)})},previousScreen:function(){0!==e()&&a(r.state.screens[e()-1].id)},changeScreen:a,requestScreenChange:n,activeScreen:function(){return i(r.state.activeScreenId)},activeScreenId:function(){return r.state.activeScreenId},previousScreenId:function(){return r.state.previousScreenId},screens:function(){return r.state.screens},screensByType:function(t){return r.state.screens.filter(function(e){return e.type===t})},relativeScreenIndex:function(e){return c(r.state.activeScreenId)-c(e)},activeScreenIndex:e,formScreenIndexById:function(e){return o(e,"form")},screenIndexById:function(e){return c(e)},formScreenIdByIndex:function(e){return r.state.screens[e].id},activeFormScreenIndex:function(){return o(r.state.activeScreenId,"form")},transitionInProgress:function(){return r.state.transitionInProgress}}}),BF.service("scroll",function(e){return e.state={scrollPosition:0,scrollbarWidth:0},e.els={$scrollContainer:$(window)},e.els.$scrollContainer.on("scroll",function(){e.state.scrollPosition=e.els.$scrollContainer.scrollTop(),e.emit(BF.events.USER_SCROLL,{y:e.state.scrollPosition})}),setTimeout(function(){e.state.scrollbarWidth=function(){var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",e.style.msOverflowStyle="scrollbar",document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var n=document.createElement("div");n.style.width="100%",e.appendChild(n);var s=n.offsetWidth;return e.parentNode.removeChild(e),t-s}()},100),{scrollbarWidth:function(){return e.state.scrollbarWidth},position:function(){return e.state.scrollPosition}}}),BF.service("window",function(e){var t;function n(){e.state.width=isNaN(window.innerWidth)?window.clientWidth:window.innerWidth,e.state.height=isNaN(window.innerHeight)?window.clientHeight:window.innerHeight}return e.props={resizeTimeoutDuration:60,mobileWidth:595,desktopWidth:1024},e.state={width:0,height:0},window.addEventListener("resize",function(){t=t||setTimeout(function(){t=null,n(),e.emit(BF.events.WINDOW_RESIZE,{width:e.state.width,height:e.state.height})},e.props.resizeTimeoutDuration)}),window.addEventListener("orientationchange",function(){e.emit(BF.events.ORIENTATION_CHANGE)}),setTimeout(function(){n()},100),{width:function(){return e.state.width},height:function(){return e.state.height},isMobile:function(){return e.state.width<e.props.mobileWidth},isTablet:function(){return e.state.width<e.props.desktopWidth&&e.state.width>e.props.mobileWidth},isDesktop:function(){return e.state.width>=e.props.desktopWidth},isLandscape:function(){return e.state.width>e.state.height}}}),BF.component("add-class-on-input-value",function(s,i){function t(){var t=!1,n=document.getElementById(s.props.id);s.props.values&&s.props.values.length?s.props.values.map(function(e){e==n.value&&(t=!0)}):t=n.value.length&&"none"!=n.value,t?i.classList.add(s.props.class):i.classList.remove(s.props.class)}s.props={names:i.getAttribute("data-name")?i.getAttribute("data-name").split(","):null,id:i.getAttribute("data-id"),values:i.getAttribute("data-value")?i.getAttribute("data-value").split(","):null,class:i.getAttribute("data-class")||"has-value"},s.props.id?function(){var e=document.getElementById(s.props.id);e&&($(e).on("change",t.bind(this)),t())}():s.on(BF.events.SET_FORM_VALUES,function(e){BF.services.form.inputMatchesValue(s.props.names,s.props.values)?i.classList.add(s.props.class):i.classList.remove(s.props.class)})}),BF.component("aria-progress",function(e,t){e.on(BF.events.SCREEN_TRANSITION_END,function(e){t.setAttribute("aria-valuemax",BF.services.screens.screensByType("form").length),t.setAttribute("aria-valuenow",BF.services.form.completedSteps().length)})}),BF.component("bra-finder-distractions",function(e,i){if(!i.getAttribute("data-bf-bra-finder-distractions"))return e.error("data-bf-bra-finder-distractions is required, and must be a valid input name");function t(){for(var e=$('.bf-modal.bf-modal--open input[name="distraction"]'),t=[],n=0;n<e.length;n++){var s=e[n];s.checked&&t.push($('label[for="'+s.id+'"]').text().trim().toLowerCase())}i.setAttribute("data-bra-finder-options",t.join())}e.init(function(){t(),e.on(BF.events.SET_FORM_VALUES,t)})}),BF.component("bra-finder-options",function(r,a){if(!a.getAttribute("data-bf-bra-finder-options"))return r.error("data-bf-bra-finder-options is required, and must be a valid input name");function e(){if(-1<r.props.inputName.indexOf(",")){for(var e=r.props.inputName.split(",").map(function(e){return e.trim()}),t=[],n=0;n<e.length;n++){var s=BF.services.form.inputValueString(e[n]);"1:sizing"===a.getAttribute("data-bra-finder-step")?s&&("closest_size"===e[n]?s.split(",").map(function(e){t.push("alpha:"+e)}):"band_size"===e[n]?t.push("band:"+s):"cup_size"===e[n]&&t.push("cup:"+s)):t.push(s)}a.setAttribute("data-bra-finder-options",t.join())}else if("2:experience"===a.getAttribute("data-bra-finder-step")){var i=BF.services.form.inputValueString(r.props.inputName);a.setAttribute("data-bra-finder-options",["holds me in","moves with me","no preference"][i])}else if("3:distractions"===a.getAttribute("data-bra-finder-step")||"6:cups"===a.getAttribute("data-bra-finder-step")){var o=BF.services.form.inputValueLabels(r.props.inputName);a.setAttribute("data-bra-finder-options",o)}else a.setAttribute("data-bra-finder-options",BF.services.form.inputValueString(r.props.inputName))}r.props={inputName:a.getAttribute("data-bf-bra-finder-options")},r.init(function(){e(),r.on(BF.events.SET_FORM_VALUES,e)})}),BF.component("button",function(t,n){t.props={preventDefault:n.hasAttribute("data-prevent-default")},n.addEventListener("keypress",function(e){32!=e.keyCode&&13!=e.keyCode||(n.click(),t.props.preventDefault&&e.preventDefault())})}),BF.component("button-shadow",function(t,n){t.props={screens:["loading","results"],hiddenClass:"hide"},t.on(BF.events.SCREEN_TRANSITION_START,function(e){-1<t.props.screens.indexOf(e.active.id)?n.classList.add(t.props.hiddenClass):n.classList.remove(t.props.hiddenClass)})}),BF.component("carousel",function(i,e){function t(){i.state.initiated||(i.state.initiated=!0,$(i.els.container).find("img").each(function(){i.els.thumbnailContainer.appendChild($(this).clone()[0])}),n(),o().each(function(){this.addEventListener("click",function(){$(i.els.container).slick("slickGoTo",$(this).index())})}),$(i.els.container).on("beforeChange",function(e,t,n,s){o().removeClass(i.props.selectedThumbnailClass),o()[s].classList.add(i.props.selectedThumbnailClass)}),o().length?o()[0].classList.add(i.props.selectedThumbnailClass):console.log("No thumbnails found..."))}function n(){$(i.els.container).slick({dots:!0,infinite:!1,speed:300,slidesToShow:1,centerMode:!1,draggable:!1,variableWidth:BF.services.window.isMobile()&&!BF.services.window.isLandscape()})}function o(){return $(i.els.thumbnailContainer).children()}i.props={selectedThumbnailClass:"selected"},i.state={initiated:!1,initHandler:null},i.els={container:e.querySelector("[data-items]"),thumbnailContainer:e.querySelector("[data-thumbnails]")},i.on(BF.events.SCREEN_TRANSITION_ACTIVE,function(){setTimeout(t,200)}),i.on(BF.events.SCREEN_TRANSITION_ACTIVE,function(){setTimeout(t,200)}),i.on(BF.events.SCREEN_TRANSITION_END,function(){$(i.els.container).slick("setPosition")}),i.on(BF.events.ORIENTATION_CHANGE,function(){i.state.initiated&&($(i.els.container).slick("unslick"),setTimeout(n,500))})}),BF.component("change-screen-link",function(t,e){if(t.props={id:e.getAttribute("data-id")},!t.props.id)return t.error("Screen Id not specified");e.addEventListener("click",function(e){e.preventDefault(),BF.services.screens.changeScreen(t.props.id)})}),BF.component("clear-form-value-on-click",function(n,e){if(n.props={propertyName:e.getAttribute("data-bf-clear-form-value-on-click")},!n.props.propertyName)return n.error("Property name not specified");e.addEventListener("click",function(){for(var e=document.querySelectorAll('input[name="'+n.props.propertyName+'"]'),t=0;t<e.length;t++){if("select"==e[t].type||"text"==e[t].type)return void(e[t].value="");e[t].checked=!1}setTimeout(function(){BF.services.form.updateFormValues()})})}),BF.component("click-element",function(t,e){return t.props={elementSelector:e.getAttribute("data-bf-click-element")},t.props.elementSelector?(t.els={element:document.querySelector(t.props.elementSelector)},t.props.element?void e.addEventListener("click",function(e){t.props.element.click()}):t.error("Element not found")):t.error("Element Id not defined")}),BF.component("close-edit-answers-link",function(t,e){e.addEventListener("click",function(e){e.preventDefault(),t.emit(BF.events.CLOSE_EDIT_ANSWERS)})}),BF.component("close-form-overlay-link",function(t,e){e.addEventListener("click",function(e){e.preventDefault(),t.emit(BF.events.CLOSE_FORM_OVERLAY)})}),BF.component("close-image-viewer-link",function(t,e){e.addEventListener("click",function(e){e.preventDefault(),t.emit(BF.events.CLOSE_IMAGE)})}),BF.component("close-modal-link",function(t,e){e.addEventListener("click",function(e){e.preventDefault(),t.emit(BF.events.CLOSE_MODAL)})}),BF.component("close-progress-link",function(t,e){e.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault(),t.emit(BF.events.CLOSE_PROGRESS_MENU)})}),BF.component("collapsable",function(e,t){e.props={openClass:"open",startOpen:t.hasAttribute("data-start-open")},e.els={clickEl:t.querySelector("[data-label]")||t},e.els.clickEl.addEventListener("click",function(){t.classList.contains(e.props.openClass)?t.classList.remove(e.props.openClass):t.classList.add(e.props.openClass)}),e.props.startOpen&&t.classList.add(e.props.openClass)}),BF.component("continue-button",function(e,t){t.addEventListener("click",function(e){BF.services.screens.requestScreenChange(BF.services.form.screenProgressValue())})}),BF.component("deselectable",function(e,t){$(t).data("waschecked",$(t).prop("checked")),t.addEventListener("click",function(){var e=$(t);1==e.data("waschecked")?(e.prop("checked",!1),e.data("waschecked",!1),BF.services.form.updateFormValues()):e.data("waschecked",!0),e.siblings('input[type="radio"]').data("waschecked",!1)})}),BF.component("distraction-form-buttons",function(e,t){function n(){setTimeout(function(){BF.services.screens.transitionInProgress()||s()})}function s(){if(BF.services.form.inputMatchesValue([e.props.inputName],e.props.options))return e.els.selectedButton&&e.els.selectedButton.removeAttribute("style"),void(e.els.unselectedButton&&(e.els.unselectedButton.style.display="none"));e.els.selectedButton&&(e.els.selectedButton.style.display="none"),e.els.unselectedButton&&e.els.unselectedButton.removeAttribute("style")}e.props={options:t.getAttribute("data-options")?t.getAttribute("data-options").split(","):null,inputName:"distraction"},e.els={selectedButton:t.querySelector("[data-selected]"),unselectedButton:t.querySelector("[data-unselected]")},e.on(BF.events.SCREEN_TRANSITION_END,n),e.on(BF.events.SET_FORM_VALUES,n),s()}),BF.component("document",function(e,t){function n(){t.style.overflow="hidden"}function s(){t.style.overflow=""}e.props={menuOpenClass:"bf-menu-open"},e.on(BF.events.OPEN_INFO_OVERLAY,n),e.on(BF.events.CLOSE_INFO_OVERLAY,s),e.on(BF.events.OPEN_EDIT_ANSWERS,n),e.on(BF.events.CLOSE_EDIT_ANSWERS,s),e.on(BF.events.OPEN_PROGRESS_MENU,function(){n(),t.classList.add(e.props.menuOpenClass)}),e.on(BF.events.CLOSE_PROGRESS_MENU,function(){s(),t.classList.remove(e.props.menuOpenClass)})}),BF.component("dynamic-select-size",function(o,e){function i(){if(null!=this.value){if("band_size"==this.name)o.state.previousBand!=this.value&&r(this.value),o.state.previousBand=this.value;if("cup_size"==this.name)o.state.previousCup!=this.value&&a(this.value),o.state.previousCup=this.value}}function r(e){var t,n=$(o.els.$cupSizes[0]),s=$(n).find("option").slice(1),i=(t=e,o.state.validCupSizes[t]);null!=i&&s.map(function(e){-1==i.indexOf(s[e].value)?(s[e].style.display="none",s[e].setAttribute("aria-hidden","true"),s[e].setAttribute("disabled","")):(s[e].removeAttribute("style"),s[e].setAttribute("aria-hidden","false"),s[e].removeAttribute("disabled"))}),o.state.previousBand=e}function a(e){var t,n=$(o.els.$bandSizes[0]),s=$(n).find("option").slice(1),i=(t=e,o.state.validBandSizes[t]);null!=i&&s.map(function(e){-1==i.indexOf(s[e].value)?(s[e].style.display="none",s[e].setAttribute("aria-hidden","true"),s[e].setAttribute("disabled","")):(s[e].removeAttribute("style"),s[e].setAttribute("aria-hidden","false"),s[e].removeAttribute("disabled"))}),o.state.previousCup=e}o.props={dropDownName:e.getAttribute("data-name")},o.els={$bandSizes:$(e).find("[name=band_size]"),$cupSizes:$(e).find("[name=cup_size]")},o.state={previousBand:null,previousCup:null,validBandSizes:{"":["30","32","34","36","38","40","42","44"],A:["30","32","34","36","38","40"],B:["30","32","34","36","38","40","42","44"],C:["30","32","34","36","38","40","42","44"],D:["30","32","34","36","38","40","42","44"],DD:["30","32","34","36","38","40","42","44"],E:["30","32","34","36","38","40","42","44"],F:["32","34","36","38"],FF:["32","34","36","38"],G:["32","34","36","38"]},validCupSizes:{"":["A","B","C","D","DD","E","F","FF","G"],30:["A","B","C","D","DD","E"],32:["A","B","C","D","DD","E","F","FF","G"],34:["A","B","C","D","DD","E","F","FF","G"],36:["A","B","C","D","DD","E","F","FF","G"],38:["A","B","C","D","DD","E","F","FF","G"],40:["A","B","C","D","DD","E"],42:["B","C","D","DD","E"],44:["B","C","D","DD","E"]}},o.init(function(){var e,t,n=BF.services.form.formValue("band_size")[0].value,s=BF.services.form.formValue("cup_size")[0].value;""!=n&&r(n),""!=s&&a(s),$.ajax({url:BF.endpoints.BandCupValidSizes.url,type:BF.endpoints.BandCupValidSizes.type,success:function(e){e.cupToBandValidSizes&&(o.state.validBandSizes=e.cupToBandValidSizes),e.bandToCupValidSizes&&(o.state.validCupSizes=e.bandToCupValidSizes)},error:function(){}}),e=o.els.$bandSizes[0],t=o.els.$cupSizes[0],e.addEventListener("change",i.bind(e)),t.addEventListener("change",i.bind(t))})}),BF.component("dynamic-template-container",function(n,s){n.props={id:s.getAttribute("data-screen-id")},n.on(BF.events.SCREEN_DATA_LOADED,function(e){var t;e.id===n.props.id&&(t=e.data,s.innerHTML="<div>"+t+"</div>",setTimeout(function(){BF.compile(s.childNodes[0])}))})}),BF.component("edit-answers",function(o,n){function r(e){var t=document.getElementById(e.getAttribute("data-mirror"));return t||o.error("Mirrored element not found: "+this.getAttribute("data-mirror")+"("+this.getAttribute("name")+")"),t}function t(){for(var e=0;e<o.els.inputs.length;e++)s(o.els.inputs[e],r(o.els.inputs[e]))}function s(e,t){var n=$(t).closest("[data-bra-finder-interaction]"),s=[];if("radio"==t.type||"checkbox"==t.type?e.checked!=t.checked&&(e.checked=t.checked,s.push(t.value+(t.checked?":selected":":unselected"))):e.value!=t.value&&(""!==e.value&&s.push(e.value+":unselected"),s.push(t.value+":selected:"),e.value=t.value),n.length&&s.length){var i=n.attr("data-bra-finder-options"),o=i?i+",":"";n.attr("data-bra-finder-options",o+s.join()),n.attr("data-updated-answer","")}$(e).change()}function i(){for(var e,t,n=0,s=[],i=0;i<o.els.inputs.length;i++)t=r(e=o.els.inputs[i]),"radio"!=e.type&&"checkbox"!=e.type?e.value!=t.value&&n++:e.checked!=t.checked&&-1===s.indexOf(e.name+("radio"==e.type?"":e.value))&&(n++,s.push(e.name+("radio"==e.type?"":e.value)));if(0==n)return o.els.$showOnMatched.css("display",""),void o.els.$showOnDiff.css("display","none");o.els.$showOnMatched.css("display","none"),o.els.$showOnDiff.css("display",""),o.els.$diffCount.text(n),o.els.$showOnDiffPlural.css("display",1!=n?"":"none"),o.els.$showOnDiffSingular.css("display",1!=n?"none":"")}function a(e){"Escape"===e.key&&o.emit(BF.events.CLOSE_EDIT_ANSWERS)}o.props={activeClass:"bf-modal--open",loadingClass:"loading"},o.els={form:n.querySelectorAll("[data-input]"),inputs:n.querySelectorAll("[data-mirror]"),content:n.querySelector("[data-content]"),$showOnMatched:$(n).find("[data-show-on-form-match]"),$showOnDiff:$(n).find("[data-show-on-form-diff]"),$diffCount:$(n).find("[data-diff-count]"),$showOnDiffPlural:$(n).find("[data-plural]"),$showOnDiffSingular:$(n).find("[data-singular]")},o.state={loading:!1},n.style.display="none",o.on(BF.events.OPEN_EDIT_ANSWERS,function(){t(),i(),document.addEventListener("keydown",a),n.style.display="",setTimeout(function(){o.els.content.scrollTop=0,window.requestAnimationFrame(function(){n.classList.add(o.props.activeClass)})},50),setTimeout(function(){n.focus()},250)}),o.on(BF.events.CLOSE_EDIT_ANSWERS,function(){var e;e=function(){BF.services.form.reset(n),t(),i()}.bind(this),window.requestAnimationFrame(function(){n.classList.remove(o.props.activeClass)}),document.removeEventListener("keydown",a),setTimeout(function(){n.style.display="none",e&&e()},500)}),o.on(BF.events.UPDATE_ANSWERS,function(){o.state.loading||(o.state.loading=!0,n.classList.add(o.props.loadingClass),function(){for(var e=0;e<o.els.inputs.length;e++)s(r(o.els.inputs[e]),o.els.inputs[e])}(),setTimeout(function(){dataLayer.push({previousFormValues:void 0,currentFormValues:void 0});var t=BF.services.form.formValues();BF.services.form.updateFormValues(),BF.services.api.call(BF.endpoints.sendProgress.url,BF.endpoints.sendProgress.type).then(function(){o.state.loading=!1,n.classList.remove(o.props.loadingClass),o.emit(BF.events.CLOSE_EDIT_ANSWERS),BF.services.screens.changeScreen("loading"),dataLayer.push({event:"bra-finder-edit-update-answers",previousFormValues:t,currentFormValues:BF.services.form.formValues()});var e=$("[data-updated-answer]");e.trigger("updatedAnswer"),e.attr("data-bra-finder-options",""),e.removeAttr("data-updated-answer")}).catch(function(e){o.state.loading=!1,n.classList.remove(o.props.loadingClass),alert("There was an error updating the form. Please try again.")})},500))}),o.init(function(){t(),i(),function(){for(var e=0;e<o.els.inputs.length;e++){o.els.inputs[e].addEventListener("change",i.bind(this))}}()})}),BF.component("form-overlay",function(t,n){if(t.props={activeClass:"bf-modal--open"},t.els={content:n.querySelector("[data-content]"),formParent:null,formContent:null},!t.els.content)return t.error("Content element not found");function s(e){"Escape"===e.key&&t.emit(BF.events.CLOSE_FORM_OVERLAY)}n.style.display="none",t.on(BF.events.OPEN_FORM_OVERLAY,function(e){t.els.formParent=document.getElementById(e),t.els.formContent=t.els.formParent.children[0],t.els.content.appendChild(t.els.formContent),document.addEventListener("keydown",s),n.style.display="",setTimeout(function(){window.requestAnimationFrame(function(){n.classList.add(t.props.activeClass)})},50),setTimeout(function(){t.els.content.focus()},250)}),t.on(BF.events.CLOSE_FORM_OVERLAY,function(){window.requestAnimationFrame(function(){n.classList.remove(t.props.activeClass)}),document.removeEventListener("keydown",s),setTimeout(function(){t.els.formContent&&t.els.formParent&&(t.els.formParent.appendChild(t.els.formContent),t.els.formParent=null,t.els.formContent=null)},500),setTimeout(function(){n.style.display="none"},500)})}),BF.component("form-step",function(n,e){n.props={screenId:e.getAttribute("data-id")},n.els={inputs:$(e).find("input,select")},n.init(function(){var e,t;e=[],t=[],n.els.inputs.each(function(){-1===e.indexOf(this.name)&&(t.push(this.name),this.hasAttribute("required")&&e.push(this.name))}),BF.services.form.registerFormStep({id:n.props.screenId,requiredFields:e,fields:t})})}),BF.component("header",function(t,n){function s(){n.classList.add(t.props.progressActiveClass)}function i(){n.classList.remove(t.props.progressActiveClass)}function o(){t.state.closeTimeoutHandler=setTimeout(function(){t.emit(BF.events.HIDE_PROGRESS_MENU),n.removeEventListener("mouseenter",r),n.removeEventListener("mouseleave",o)},t.props.closeProgressTimeoutLength)}function r(){clearTimeout(t.state.closeTimeoutHandler)}t.props={progressOpenClass:"bf-header--progress-open",progressActiveClass:"bf-header--progress-active",closeProgressTimeoutLength:1e3},t.state={closeTimeoutHandler:null},t.on(BF.events.OPEN_PROGRESS_MENU,function(){n.classList.add(t.props.progressOpenClass)}),t.on(BF.events.CLOSE_PROGRESS_MENU,function(){n.classList.remove(t.props.progressOpenClass)}),t.on(BF.events.SCREEN_TRANSITION_START,function(e){clearTimeout(t.state.closeTimeoutHandler),n.removeEventListener("mouseenter",r),n.removeEventListener("mouseleave",o)}),t.on(BF.events.SCREEN_TRANSITION_ACTIVE,function(e){BF.helpers.isFormScreen(e.active)?s():i()}),t.on(BF.events.SHOW_PROGRESS_MENU,function(){s(),n.addEventListener("mouseenter",r),n.addEventListener("mouseleave",o)}),t.on(BF.events.HIDE_PROGRESS_MENU,function(){i(),n.removeEventListener("mouseenter",r),n.removeEventListener("mouseleave",o)})}),BF.component("hide-on-form-complete",function(t,n){t.props={pageLoadTime:2e3,changeLength:1e3},t.state={pageLoaded:!1},t.on(BF.events.SET_FORM_VALUES,function(e){setTimeout(function(){BF.services.form.screenProgressValue()==BF.services.screens.screens().length-1?setTimeout(function(){n.style.display="none",n.setAttribute("aria-hidden","true")},t.state.pageLoaded?t.props.changeLength:0):setTimeout(function(){n.removeAttribute("style"),n.setAttribute("aria-hidden","false")},t.state.pageLoaded?t.props.changeLength:0)})}),setTimeout(function(){t.state.pageLoaded=!0},t.props.pageLoadTime)}),BF.component("hide-on-form-progress",function(e,t){function n(){0<BF.services.form.screenProgressValue()?setTimeout(function(){t.style.display="none",t.setAttribute("aria-hidden","true")},e.state.pageLoaded?e.props.changeLength:0):setTimeout(function(){t.removeAttribute("style"),t.setAttribute("aria-hidden","false")},e.state.pageLoaded?e.props.changeLength:0)}e.props={pageLoadTime:2e3,changeLength:1e3},e.state={pageLoaded:!1},e.on(BF.events.SET_FORM_VALUES,function(){setTimeout(n)}),setTimeout(function(){e.state.pageLoaded=!0},e.props.pageLoadTime)}),BF.component("hide-on-input-value",function(e,t){function n(){setTimeout(function(){BF.services.screens.transitionInProgress()||s()})}function s(){setTimeout(function(){BF.services.form.inputMatchesValue(e.props.names,e.props.values)?t.style.display="none":t.removeAttribute("style")},e.props.delay)}e.props={names:t.getAttribute("data-name").split(","),values:t.getAttribute("data-value")?t.getAttribute("data-value").split(","):null,delay:t.getAttribute("data-delay")?t.getAttribute("data-delay"):0},e.on(BF.events.SCREEN_TRANSITION_END,n),e.on(BF.events.SET_FORM_VALUES,n),s()}),BF.component("image",function(e,t){function n(){t.classList.add("loaded")}t.complete&&0!==t.naturalHeight?n():t.addEventListener("load",n.bind(this))}),BF.component("image-gallery",function(a,e){if(a.els={images:e.querySelectorAll("[data-image]"),pswp:document.querySelector(".pswp")},!a.els.pswp)return a.error("Image gallery element not found");function t(e){for(var t=[],n=null,s=null,i=BF.services.window.isDesktop()?100:0,o=0;o<a.els.images.length;o++)n=a.els.images[o],t.push({src:n.getAttribute("data-image"),w:parseInt(n.getAttribute("data-image-width"))||500,h:parseInt(n.getAttribute("data-image-height"))||500,title:n.getAttribute("data-title")});var r={index:e||0,history:!1,bgOpacity:.8,showAnimationDuration:300,loadingIndicatorDelay:0,preloaderEl:!0,getDoubleTapZoom:function(e,t){return e?1:t.initialZoomLevel<.7?1:1.2},barsSize:{top:100,bottom:100,left:i,right:i}};(s=new PhotoSwipe(a.els.pswp,window.PhotoSwipeUI_Default,t,r)).init(),s.listen("imageLoadComplete",function(e,t){setTimeout(function(){s.items.map(function(e){if(e.container){var t=e.container.querySelector("img");t&&t.complete&&t.classList.add("loaded")}})},300)})}for(var n=0;n<a.els.images.length;n++)a.els.images[n].setAttribute("image-gallery-index",n),a.els.images[n].addEventListener("click",function(e){e.preventDefault(),t(parseInt(this.getAttribute("image-gallery-index")))})}),BF.component("image-viewer",function(r,a){if(r.props={activeClass:"bf-modal--open",loadingClass:"bf-modal--loading"},r.els={imageContainer:a.querySelector("[data-image-container]")},!r.els.imageContainer)return r.error("Image container element not found");function t(e){"Escape"===e.key&&r.emit(BF.events.CLOSE_IMAGE)}a.style.display="none",r.on(BF.events.OPEN_IMAGE,function(e){document.addEventListener("keydown",t),a.style.display="",setTimeout(function(){window.requestAnimationFrame(function(){a.classList.add(r.props.loadingClass),a.classList.add(r.props.activeClass)})},50);var o=document.createElement("img");(o=new Image).onload=function(){r.els.imageContainer.innerHTML="",r.els.imageContainer.appendChild(o);var e=o.naturalWidth/o.naturalHeight,t=r.els.imageContainer.offsetHeight,n=r.els.imageContainer.offsetWidth,s=n/t,i="auto"===getComputedStyle(r.els.imageContainer).overflowX;s<e&&i?(o.style.height=t+"px",o.style.width=t*e+"px"):s<e?(o.style.width=n+"px",o.style.height=n/e+"px"):(o.style.height=t+"px",o.style.width=t*e+"px"),window.requestAnimationFrame(function(){a.classList.remove(r.props.loadingClass)}),setTimeout(function(){o.focus()},250)},o.onerror=function(){alert("There was an error loading the image"),r.emit(BF.events.CLOSE_IMAGE),a.classList.remove(r.props.loadingClass)},o.setAttribute("alt",e.title),o.src=e.url}),r.on(BF.events.CLOSE_IMAGE,function(){window.requestAnimationFrame(function(){a.classList.remove(r.props.activeClass)}),document.removeEventListener("keydown",t),setTimeout(function(){a.style.display="none",r.els.imageContainer.innerHTML=""},500)})}),BF.component("init-footer-navigation",function(e,t){BF.services.window.isDesktop()&&$("details.collapse-mobile-only").attr("open",!0)}),BF.component("input-button",function(t,e){t.props={inputId:e.getAttribute("data-input-id"),inputValue:e.getAttribute("data-input-value")},t.els={input:t.props.inputId?document.getElementById(t.props.inputId):null},e.addEventListener("click",function(e){t.els.input&&("radio"!=t.els.input.type&&"checkbox"!=t.els.input.type||(t.els.input.checked=!0)),BF.services.form.updateFormValues()})}),BF.component("load-template",function(t,n){return n.getAttribute("data-template-id")?(t.props={template:document.getElementById(n.getAttribute("data-template-id")).innerHTML},t.props.template?void t.init(function(){var e=$(t.props.template)[0];$(n).replaceWith(e),BF.compile(e)}):t.error("Valid template ID required")):t.error("Template id not specified")}),BF.component("load-template-before-screen",function(t,e){var n=e.getAttribute("data-template"),s=document.getElementById(n);if(!s)return t.error("Valid template Id required. "+(n?"Specified Id was "+n:"Id not specified"));function i(){t.state.loaded=!0,t.els.template=$(t.props.template)[0],$(e).replaceWith(t.els.template),BF.compile(t.els.template)}t.props={id:e.getAttribute("data-id"),template:s.innerHTML},t.state={loaded:!1},t.els={template:null},t.on(BF.events.SCREEN_TRANSITION_START,function(e){t.state.loaded||e.active.id!==t.props.id||i()}),t.on(BF.events.SCREEN_TRANSITION_END,function(e){!t.state.loaded&&-1<=BF.services.screens.relativeScreenIndex(t.props.id)&&BF.services.screens.relativeScreenIndex(t.props.id)<=1&&i()})}),BF.component("loading-screen",function(t,e){t.props={id:e.getAttribute("data-id"),loadingTime:2e3},t.on(BF.events.SCREEN_TRANSITION_END,function(e){e.active.id===t.props.id&&setTimeout(function(){BF.services.screens.nextScreen()},t.props.loadingTime)})}),BF.component("logo",function(t,n){t.props={visibleClass:"bf-logo--visible",disableTransitionClass:"bf-logo--disable-transitions",checkpointClass:"bf-logo--checkpoint",resultsClass:"bf-logo--results",smallClass:"bf-logo--small",largeClass:"bf-logo--large"},t.on(BF.events.SCREEN_TRANSITION_ACTIVE,function(e){$(n).removeClass([t.props.visibleClass,t.props.smallClass,t.props.largeClass,t.props.checkpointClass,t.props.resultsClass].join(" ")),"checkpoint"===e.active.type||"results"===e.active.id||"loading"===e.active.id?n.classList.remove(t.props.visibleClass):n.classList.add(t.props.visibleClass),"start"!==e.active.id&&"checkpoint"!==e.active.type?n.classList.add(t.props.smallClass):n.classList.add(t.props.largeClass),"checkpoint"===e.active.type&&n.classList.add(t.props.checkpointClass),"results"===e.active.id&&n.classList.add(t.props.resultsClass)}),n.classList.add(t.props.disableTransitionClass),setTimeout(function(){n.classList.remove(t.props.disableTransitionClass)},2e3)}),BF.component("modal",function(s,i){if(s.props={activeClass:"bf-modal--open"},s.els={content:i.querySelector("[data-content]"),scrollContainer:i.querySelector("[data-scroll-container]")},s.state={open:!1},!s.els.content)return s.error("Content element not found");function o(){return new Promise(function(e,t){window.requestAnimationFrame(function(){i.classList.remove(s.props.activeClass)}),document.removeEventListener("keydown",r),setTimeout(function(){i.style.display="none",s.state.open=!1,e()},500)})}function r(e){"Escape"===e.key&&s.emit(BF.events.CLOSE_MODAL)}i.style.display="none",s.on(BF.events.OPEN_MODAL,function e(t){if(s.state.open)return o().then(function(){e(t)});s.state.open=!0;var n=document.getElementById(t);if(!n)return s.error("Info overlay template not found");s.els.content.innerHTML=n.innerHTML,BF.compile(s.els.content),document.addEventListener("keydown",r),i.style.display="",setTimeout(function(){window.requestAnimationFrame(function(){i.classList.add(s.props.activeClass),s.els.scrollContainer.scrollTop=0})},50),setTimeout(function(){s.els.content.focus()},250)}),s.on(BF.events.CLOSE_MODAL,o)}),BF.component("modal-form",function(o,t){if(o.state={loading:!1},o.props={loadingClass:"loading",completedClass:"completed",errorClass:"has-error",endpoint:BF.endpoints[t.getAttribute("data-endpoint-name")]},!o.props.endpoint)return o.error("Endpoint not found");o.els={$closeLinks:$(t).find("[data-close-response-modal]"),responseContainer:t.querySelector("[data-response-container]")},o.els.$closeLinks.on("click",function(e){e.preventDefault(),t.classList.remove(o.props.completedClass)}),t.addEventListener("submit",function(e){e.preventDefault(),o.state.loading||(o.state.loading=!0,t.classList.remove(o.props.errorClass),$.ajax({url:o.props.endpoint.url,type:o.props.endpoint.type,data:$(t).serializeArray(),success:function(e){o.els.responseContainer.innerHTML="<div>"+e+"</div>",o.state.loading=!1,t.classList.add(o.props.completedClass),function(e){var t={event:"braFinderEvent",eventCategory:"bra finder",eventAction:"1: sizing"};if(-1<o.props.endpoint.url.indexOf("BraFinder-Measurement")){$(e).find("#measurement-results")&&(t.eventLabel="calculate results: "+$(e).find("#measurement-results")[0].innerText,dataLayer.push(t))}if(-1<o.props.endpoint.url.indexOf("BraFinder-SisterSize")){$(e).find("#recorded-size")&&(t.eventLabel="recorded size: "+$(e).find("#recorded-size")[0].innerText,dataLayer.push(t))}}(e),function(){if(-1<o.props.endpoint.url.indexOf("BraFinder-Measurement")){var e=document.querySelector("#measurement-results").innerText;o.els.responseContainer.dataset.braFinderInteraction="calculate results: "+e,o.els.responseContainer.dataset.eventLabel="calculate results: "+e;var t=new Event("size-calculated",{bubbles:!0});o.els.responseContainer.dispatchEvent(t)}else if(-1<o.props.endpoint.url.indexOf("BraFinder-SisterSize")){var n=document.querySelector("input[name=band]").value,s=document.querySelector("input[name=cup]").value;o.els.responseContainer.dataset.event="braFinderEvent",o.els.responseContainer.dataset.eventCategory="bra finder",o.els.responseContainer.dataset.eventAction="1:sizing",o.els.responseContainer.dataset.eventLabel="recorded size: "+n+s,o.els.responseContainer.dataset.braFinderStep="1:sizing",o.els.responseContainer.dataset.braFinderInteraction="recorded size: "+n+s;var i=new Event("size-submit-clicked",{bubbles:!0});o.els.responseContainer.dispatchEvent(i)}}()},error:function(){o.state.loading=!1,t.classList.add(o.props.errorClass)}}))})}),BF.component("modal-link",function(t,e){t.props={templateId:e.getAttribute("data-template-id")},t.state={open:!1},e.addEventListener("click",function(e){e.preventDefault(),t.state.open=!0,t.emit(BF.events.OPEN_MODAL,t.props.templateId)}),t.on(BF.events.OPEN_MODAL,function(){t.state.open&&(t.state.open=!1,e.focus())})}),BF.component("next-screen-link",function(e,t){t.addEventListener("click",function(e){BF.services.screens.nextScreen()})}),BF.component("open-edit-answers",function(t,e){e.addEventListener("click",function(e){e.preventDefault(),t.emit(BF.events.OPEN_EDIT_ANSWERS)}),t.on(BF.events.CLOSE_EDIT_ANSWERS,function(){e.focus()})}),BF.component("open-form-overlay",function(t,e){if(t.props={id:e.getAttribute("data-content")},!document.getElementById(t.props.id))return t.error("Form element "+t.props.id+" not found");t.state={open:!1},e.addEventListener("click",function(e){e.preventDefault(),t.state.open=!0,t.emit(BF.events.OPEN_FORM_OVERLAY,t.props.id)}),t.on(BF.events.CLOSE_FORM_OVERLAY,function(){t.state.open&&(t.state.open=!1,e.focus())})}),BF.component("open-image",function(t,e){t.props={url:e.getAttribute("data-bf-open-image"),mobileUrl:e.getAttribute("data-mobile-image"),title:e.getAttribute("data-title")},t.state={open:!1},e.addEventListener("click",function(e){e.preventDefault(),t.state.open=!0,t.emit(BF.events.OPEN_IMAGE,{url:t.props.mobileUrl&&BF.services.window.isMobile()?t.props.mobileUrl:t.props.url,title:t.props.title})}),t.on(BF.events.CLOSE_IMAGE,function(){t.state.open&&(t.state.open=!1,e.focus())})}),BF.component("open-progress-link",function(t,e){BF.services.device.hasTouch&&e.addEventListener("click",function(e){t.emit(BF.events.OPEN_PROGRESS_MENU)})}),BF.component("page",function(e,t){e.on(BF.events.OPEN_INFO_OVERLAY,function(){t.scrollHeight>t.offsetHeight&&(t.style.paddingRight=BF.services.scroll.scrollbarWidth()+"px")}),e.on(BF.events.CLOSE_INFO_OVERLAY,function(){t.style.paddingRight=""})}),BF.component("previous-screen-link",function(e,t){t.addEventListener("click",function(e){BF.services.screens.previousScreen()})}),BF.component("progress",function(s,n){function e(){s.els.items.each(function(t){this.addEventListener("click",function(e){e.stopPropagation(),i(t,this)}),this.addEventListener("keypress",function(e){32!=e.keyCode&&13!=e.keyCode||(e.stopPropagation(),e.preventDefault(),i(t,this))})}),BF.services.device.hasTouch||(n.classList.add(s.props.canHoverClass),s.els.items.each(function(e){this.addEventListener("mouseenter",function(e){BF.services.form.completedByIndex($(e.target).index())&&d()!==$(e.target).index()?n.classList.add(s.props.hoveredClass):t()}.bind(s))}),n.addEventListener("mouseleave",function(){t()}))}function i(e,t){s.state.open&&s.emit(BF.events.CLOSE_PROGRESS_MENU),event={event:"braFinderEvent",eventCategory:"bra finder",eventAction:"nav from| "+(BF.services.screens.activeFormScreenIndex()+1)+": "+BF.services.screens.activeScreenId(),eventLabel:"nav to| "+(e+1)+": "+BF.services.screens.formScreenIdByIndex(t.getAttribute("data-index"))},dataLayer.push(event),BF.services.form.completedByIndex(e)&&BF.services.screens.changeScreen(p()[e].id)}function t(){n.classList.remove(s.props.hoveredClass),n.classList.add(s.props.recentlyHoveredClass),setTimeout(function(){n.classList.remove(s.props.recentlyHoveredClass)},200)}function o(){var e;s.els.items.removeClass(s.props.itemActiveClass),null!==d()&&s.els.items[d()]&&((e=s.els.items[d()]).classList.add(s.props.itemActiveClass),a(e,"role","heading"),a(e,"tabindex","0")),s.els.items.removeClass([s.props.itemCompleteClass,s.props.itemIncompleteClass].join(" ")),s.els.items.each(function(e){var t,n;e!==d()&&(BF.services.form.completedByIndex(e)?((n=this).classList.add(s.props.itemCompleteClass),a(n,"role","link"),a(n,"tabindex","0")):((t=this).classList.add(s.props.itemIncompleteClass),a(t,"role",""),a(t,"tabindex","")))})}function r(){s.state.width=n.offsetWidth,c(d())}function a(e,t,n){e.hasAttribute(t)&&e.getAttribute(t)==n||e.setAttribute(t,n)}function c(e){s.els.indicator.style.opacity=e>=p().length?0:1;var t=e/(s.props.numberOfItems-1);$(s.els.indicator).css(BF.helpers.prefixedCssObject({transform:"translateX("+(e===p().length?s.state.width:s.state.width*t)+"px)"})),$(s.els.indicator).css({top:1<t?"100%":100*t+"%"})}function l(){n.classList.add(s.props.activeClass),n.classList.add(s.props.openingClass),setTimeout(function(){n.classList.remove(s.props.openingClass)},500)}function u(){n.classList.remove(s.props.activeClass)}function d(){return BF.services.screens.formScreenIndexById(BF.services.screens.activeScreenId())}function p(){return BF.services.screens.screensByType("form")}s.props={activeClass:"bf-progress--active",openClass:"bf-progress--open",openingClass:"bf-progress--opening",closingClass:"bf-progress--closing",hoveredClass:"bf-progress--hovered",recentlyHoveredClass:"bf-progress--recently-hovered",canHoverClass:"bf-progress--can-hover",noTransitionDelayClass:"bf-progress--no-delay",screenChangeClass:"bf-progress--in-screen-change",numberOfItems:$(n.querySelector("[data-items]")).children().length,itemActiveClass:"active",itemCompleteClass:"completed",itemIncompleteClass:"incomplete"},s.state={width:n.offsetWidth,open:!1},s.els={indicator:n.querySelector("[data-active-indicator]"),items:$(n.querySelector("[data-items]")).children()},s.on(BF.events.SCREEN_TRANSITION_START,function(t){n.classList.add(s.props.screenChangeClass),n.classList.remove(s.props.hoveredClass,n.classList.remove(s.props.recentlyHoveredClass)),s.els.items.removeClass(s.props.itemActiveClass),o(),setTimeout(function(){var e;c(e=BF.services.screens.formScreenIndexById(t.active.id)),setTimeout(function(e){s.els.indicator.textContent=e+1<p().length?e+1:p().length},250,e)},700)}),s.on(BF.events.SCREEN_TRANSITION_ACTIVE,function(e){BF.helpers.isFormScreen(e.active)?l():u()}),s.on(BF.events.SCREEN_TRANSITION_END,function(e){n.classList.remove(s.props.screenChangeClass),BF.helpers.isFormScreen(e.active)&&setTimeout(function(){r()},300)}),s.on(BF.events.WINDOW_RESIZE,function(){r()}),s.on(BF.events.OPEN_PROGRESS_MENU,function(){s.state.open||(s.state.open=!0,n.classList.add(s.props.openClass),s.emit(BF.events.HIDE_SCREENS))}),s.on(BF.events.CLOSE_PROGRESS_MENU,function(){s.state.open&&(s.state.open=!1,n.classList.remove(s.props.openClass),s.emit(BF.events.SHOW_SCREENS),n.classList.add(s.props.closingClass),setTimeout(function(){n.classList.remove(s.props.closingClass)},100),setTimeout(function(){r()}))}),s.on(BF.events.SHOW_PROGRESS_MENU,function(){r(),n.classList.add(s.props.noTransitionDelayClass),l()}),s.on(BF.events.HIDE_PROGRESS_MENU,function(){n.classList.remove(s.props.noTransitionDelayClass),u()}),s.init(function(){setTimeout(o),e()})}),BF.component("progress-input",function(e,t){e.on(BF.events.SCREEN_TRANSITION_START,function(){var e=BF.services.screens.activeScreenIndex();t.value=e>t.value?e:t.value})}),BF.component("responsive-bg-image",function(e,t){function n(){t.style.backgroundImage="url('"+(BF.services.window.isMobile()?e.props.mobileUrl:BF.services.window.isTablet()?e.props.tabletUrl:e.props.desktopUrl)+"')"}e.props={desktopUrl:t.getAttribute("data-desktop"),tabletUrl:t.getAttribute("data-tablet"),mobileUrl:t.getAttribute("data-mobile")},e.on(BF.events.WINDOW_RESIZE,n),setTimeout(function(){n()},500)}),BF.component("restart-link",function(e,t){t.addEventListener("click",function(e){BF.services.api.call(BF.endpoints.restartQuiz.url,BF.endpoints.restartQuiz.type).then(function(){BF.services.form.reset(),setTimeout(function(){BF.services.screens.changeScreen("size")})})})}),BF.component("screen",function(n,s){var e=s.getAttribute("data-class-prefix")||"bf-screen--";function t(){BF.helpers.isIE()&&setTimeout(function(){var e=$(s).children().first().outerHeight();s.style.height=e>BF.services.window.height()||BF.services.window.width()<1e3?"":e+"px"})}function i(e){return e.active.id===n.props.id}function o(e){return!!e.previous&&e.previous.id===n.props.id}n.props={id:s.getAttribute("data-id"),type:s.getAttribute("data-type")||null,hasPriority:s.hasAttribute("data-priority-screen"),dependency:s.getAttribute("data-wait-for")||null,renderClass:e+"render",enterClass:e+"enter",enterActiveClass:e+"enter-active",enterReverseActiveClass:e+"enter-reverse-active",leaveClass:e+"leave",leaveActiveClass:e+"leave-active",leaveReverseActiveClass:e+"leave-reverse-active",activeClass:e+"active"},n.on(BF.events.SCREEN_TRANSITION_START,function(e){s.classList.remove(n.props.activeClass),i(e)?($(s).addClass([n.props.renderClass,n.props.enterClass].join(" ")),setTimeout(function(){t()})):o(e)?$(s).addClass([n.props.renderClass,n.props.leaveClass].join(" ")):s.classList.remove(n.props.renderClass)}),n.on(BF.events.SCREEN_TRANSITION_ACTIVE,function(e){var t;$(s).removeClass([n.props.enterClass,n.props.leaveClass].join(" ")),i(e)&&(s.classList.add(n.props.enterActiveClass),e.reverse&&s.classList.add(n.props.enterReverseActiveClass)),o(e)&&(s.classList.add(n.props.leaveActiveClass),e.reverse&&s.classList.add(n.props.leaveReverseActiveClass)),i(e)&&e.previous&&((t=s.querySelector("[data-focus-first]"))?t.focus({preventScroll:!0}):s.focus({preventScroll:!0}),window.scrollTo({top:0,left:0,behavior:"smooth"}))}),n.on(BF.events.SCREEN_TRANSITION_END,function(e){$(s).removeClass([n.props.enterActiveClass,n.props.leaveActiveClass,n.props.enterReverseActiveClass,n.props.leaveReverseActiveClass].join(" ")),i(e)&&(s.classList.add(n.props.activeClass),setTimeout(function(){t()})),o(e)&&s.classList.remove(n.props.renderClass)}),n.on(BF.events.HIDE_SCREENS,function(){s.style.display="none"}),n.on(BF.events.SHOW_SCREENS,function(){s.style.display=""}),n.on(BF.events.WINDOW_RESIZE,function(){BF.services.screens.activeScreenId()==n.props.id&&setTimeout(t,50)}),n.init(function(){BF.services.screens.registerScreen({id:n.props.id,type:n.props.type,hasPriority:n.props.hasPriority,dependency:n.props.dependency&&BF.endpoints[n.props.dependency]?function(){return BF.services.api.call(BF.endpoints[n.props.dependency].url,BF.endpoints[n.props.dependency].type)}:null})})}),BF.component("screen-load-button",function(e,t){e.props={buttonLoadingClass:"bf-button--loading"},e.on(BF.events.LOADING_SCREEN_DATA,function(){t.classList.add(e.props.buttonLoadingClass)}),e.on(BF.events.SCREEN_DATA_LOADED,function(){t.classList.remove(e.props.buttonLoadingClass)})}),BF.component("select-toggle",function(s,e){s.props={inputName:e.getAttribute("data-bf-select-toggle"),inactiveClass:"bf-dimmed",activeClass:"bf-selected"},s.els={$options:$(e).find("[data-option]")},s.state={selectedIndex:null},s.on(BF.events.SET_FORM_VALUES,function(e){var t=e.filter(function(e){return e.name==s.props.inputName});if(s.els.$options.removeClass(s.props.inactiveClass+" "+s.props.activeClass),t.length){var n=t[0].value;n&&n.length?s.els.$options.each(function(e){this.getAttribute("data-option")===n?(s.state.selectedIndex=e,this.classList.add(s.props.activeClass)):this.classList.add(s.props.inactiveClass)}):s.state.selectedIndex=null}else s.state.selectedIndex=null})}),BF.component("send-form-progress",function(e,t){t.addEventListener("click",function(e){BF.services.form.sendFormProgress()})}),BF.component("show-on-form-complete",function(t,n){t.props={pageLoadTime:2e3,changeLength:1e3},t.state={pageLoaded:!1},t.on(BF.events.SET_FORM_VALUES,function(e){setTimeout(function(){BF.services.form.screenProgressValue()==BF.services.screens.screens().length-1?setTimeout(function(){n.removeAttribute("style"),n.setAttribute("aria-hidden","false")},t.state.pageLoaded?t.props.changeLength:0):setTimeout(function(){n.style.display="none",n.setAttribute("aria-hidden","true")},t.state.pageLoaded?t.props.changeLength:0)})}),setTimeout(function(){t.state.pageLoaded=!0},t.props.pageLoadTime)}),BF.component("show-on-form-progress",function(e,t){function n(){0<BF.services.form.screenProgressValue()?setTimeout(function(){t.removeAttribute("style"),t.setAttribute("aria-hidden","false")},e.state.pageLoaded?e.props.changeLength:0):setTimeout(function(){t.style.display="none",t.setAttribute("aria-hidden","true")},e.state.pageLoaded?e.props.changeLength:0)}e.props={pageLoadTime:2e3,changeLength:1e3},e.state={pageLoaded:!1},e.on(BF.events.SET_FORM_VALUES,function(){setTimeout(n)}),setTimeout(function(){e.state.pageLoaded=!0},e.props.pageLoadTime)}),BF.component("show-on-form-value",function(n,s){n.props={name:s.getAttribute("data-name"),value:s.getAttribute("data-value")},n.on(BF.events.SET_FORM_VALUES,function(e){var t=e.filter(function(e){return e.name==n.props.name});t.length&&t[0].value===n.props.value?(s.removeAttribute("style"),s.setAttribute("aria-hidden","false")):(s.style.display="none",s.setAttribute("aria-hidden","true"))})}),BF.component("show-on-input-value",function(e,t){function n(){setTimeout(function(){BF.services.screens.transitionInProgress()||s()})}function s(){setTimeout(function(){BF.services.form.inputMatchesValue(e.props.names,e.props.values)?t.removeAttribute("style"):t.style.display="none"},e.props.delay)}e.props={names:t.getAttribute("data-name").split(","),values:t.getAttribute("data-value")?t.getAttribute("data-value").split(","):null,delay:t.getAttribute("data-delay")?t.getAttribute("data-delay"):0},e.on(BF.events.SCREEN_TRANSITION_END,n),e.on(BF.events.SET_FORM_VALUES,n),s()}),BF.component("show-progress-link",function(t,e){t.els={nav:document.querySelector("[data-bf-progress]")},e.addEventListener("click",function(e){e.preventDefault(),BF.services.device.hasTouch?t.emit(BF.events.OPEN_PROGRESS_MENU):t.emit(BF.events.SHOW_PROGRESS_MENU),setTimeout(function(){t.els.nav&&$(t.els.nav.querySelector("[data-items]")).children()[0].focus()},500)})}),BF.component("size-buttons",function(s,e){s.props={inputs:["band_size","cup_size","closest_size"]},s.els={skip:e.querySelector("[data-skip]"),next:e.querySelector("[data-next]")},s.on(BF.events.SET_FORM_VALUES,function(e){var t=e.filter(function(e){return-1<s.props.inputs.indexOf(e.name)}),n=!1;if(t.map(function(e){e.value&&e.value.length&&(n=!0)}),n)return s.els.skip.style.display="none",void s.els.next.removeAttribute("style");s.els.next.style.display="none",s.els.skip.removeAttribute("style")})}),BF.component("size-screen-buttons",function(e,t){function n(){setTimeout(function(){BF.services.screens.transitionInProgress()||s()})}function s(){if(BF.services.form.inputMatchesValue(["closest_size"])||BF.services.form.inputMatchesValue(["band_size"])&&BF.services.form.inputMatchesValue(["cup_size"]))return e.els.next&&e.els.next.removeAttribute("style"),void(e.els.skip&&(e.els.skip.style.display="none"));e.els.skip&&e.els.skip.removeAttribute("style"),e.els.next&&(e.els.next.style.display="none")}e.els={next:t.querySelector("[data-next]"),skip:t.querySelector("[data-skip]")},e.on(BF.events.SCREEN_TRANSITION_END,n),e.on(BF.events.SET_FORM_VALUES,n),s()}),BF.component("svg",function(n,s){if(n.props={loadedClass:s.getAttribute("data-loaded-class")||"bf-media--loaded",svgUrl:s.getAttribute("data-url")},n.state={loaded:!1},n.els={container:s.querySelector("[data-image-container]")||s},!n.props.svgUrl)return n.error("SVG url not found");n.init(function(){$.get(n.props.svgUrl,function(e){var t;void 0!==(t="object"==typeof e&&"function"==typeof e.querySelector?e.querySelector("svg"):$(e).find("svg")[0])&&(n.els.container.appendChild(t),n.state.loaded=!0,s.classList.add(n.props.loadedClass))}).fail(function(){n.error("Failed to load image")})})}),BF.component("tab-nav",function(t,e){function n(e){t.els.$buttons.removeClass("active"),t.els.$buttons.each(function(){this.getAttribute("data-tab-button")==e&&this.classList.add("active")}),t.els.$tabs.css("display","none"),t.els.$tabs.each(function(){this.getAttribute("data-tab")==e&&(this.removeAttribute("style"),this.scrollTop=0)})}t.els={$tabs:$(e).find("[data-tab]"),$buttons:$(e).find("[data-tab-button]")},t.els.$tabs.css("display","none"),t.els.$buttons.on("click",function(){n(this.getAttribute("data-tab-button"))}),n(t.els.$buttons[0].getAttribute("data-tab-button"))}),BF.component("update-answers-link",function(t,e){e.addEventListener("click",function(e){e.preventDefault(),t.emit(BF.events.UPDATE_ANSWERS)})}),BF.component("update-with-size",function(l,e){l.state={invalidSizes:["30f","30ff","30g","40f","40ff","40g","42a","42f","42ff","42g","44a","44f","44ff","44g"]},l.init(function(){$.ajax({url:BF.endpoints.BandCupInvalidSizes.url,type:BF.endpoints.BandCupInvalidSizes.type,success:function(e){e.unsupported&&(l.state.invalidSizes=e.unsupported)},error:function(e){}})}),l.on(BF.events.CLOSE_MODAL,function(){var e,t=$(document.getElementsByClassName("bf-self-measure")[1]);if(null!=t){var n=$(t).find("p");if(n=n&&n[0].innerText.toLowerCase(),e=n,!(-1<l.state.invalidSizes.indexOf(e))){var s=n.substring(0,2),i=n.substring(2).trim().toUpperCase(),o=document.getElementsByClassName("bf-select-set")[0],r=$(o).find("[name=band_size]")[0],a=$(o).find("[name=cup_size]")[0];$(r).val(s).prop("selected",!0),$(a).val(i).prop("selected",!0),BF.services.form.updateFormValues();var c=new Event("change");r.dispatchEvent(c),a.dispatchEvent(c)}}})}),BF.component("window-height",function(e,t){t.style.height=(t.hasAttribute("data-offset")?parseInt(t.getAttribute("data-offset")):0)+window.innerHeight+"px"});
